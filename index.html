<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Avee-like Media Player (PHP/XAMPP)</title>
  <link rel="stylesheet" href="assets/style.css?v=20251020-20">
  
  <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
</head>
<body>
  
  <main>
    <div id="app" class="md-container md-grid app-grid">
      <!-- Library Sidebar -->
      <aside class="sidebar library">
        <div class="toolbar">
          <input type="text" id="search" placeholder="Search library..." />
          <button id="rescan" title="Rescan music folder">Rescan</button>
          <label class="upload-btn" title="Upload audio files">
            Upload
            <input type="file" id="upload-input" accept="audio/*" multiple />
          </label>
        </div>
        <details class="lib-collapsible">
          <summary>Import from URL</summary>
          <div class="toolbar">
            <input type="url" id="import-url" placeholder="Import audio URL (e.g., Dropbox direct link)" />
            <button id="import-url-btn" title="Download from URL">Import</button>
          </div>
        </details>

        <details class="lib-collapsible">
          <summary>Cloud Connections</summary>
          <div class="toolbar">
            <button id="connect-dropbox" class="btn">Connect Dropbox</button>
            <button id="connect-google" class="btn">Connect Google Drive</button>
          </div>
        </details>

        <ul id="library-list" class="list"></ul>

        <details class="lib-collapsible">
          <summary>Cloud Files</summary>
          <ul id="cloud-list" class="list"></ul>
        </details>
      </aside>

      <!-- Player Core -->
      <section class="player-core">
        <div class="art-and-info">
          <div id="art" class="art"></div>
          <div class="track-info">
            <div id="track-title" class="track-title">—</div>
            <div id="track-time" class="track-time">0:00 / 0:00</div>
          </div>
        </div>

        <!-- Visualizer layout wraps canvas + controls + tuning + EQ + logger -->
        <div class="viz-layout">

          <h2 class="viz-title">My Web Visualizer</h2>

          <canvas id="viz" width="960" height="300"></canvas>

          <div class="controls">
            <button id="prev" class="btn secondary">Prev</button>
            <button id="play" class="btn success">Play</button>
            <button id="next" class="btn secondary">Next</button>
            <button id="shuffle" class="btn secondary" title="Shuffle">Shuffle</button>
            <button id="repeat" class="btn secondary" title="Repeat">Repeat</button>

            <div class="slider-group">
              <label>Volume</label>
              <input type="range" id="volume" min="0" max="1" step="0.01" value="0.9"/>
            </div>

            <div class="slider-group">
              <label>Speed</label>
              <input type="range" id="rate" min="0.5" max="2" step="0.01" value="1"/>
            </div>

            <button id="pitch-lock" class="btn success" title="Preserve pitch when changing speed">Pitch Lock</button>

            <button id="delete-track" class="btn danger" title="Delete current track">Delete Track</button>
            
          </div>

          <!-- Floating Customize button + drawer -->
          <button id="fab-customize" class="md-fab" aria-label="Customize visualizer" title="Customize">✎</button>
          <button id="fab-layers" class="md-fab" aria-label="Layers" title="Layers">☷</button>
          <div id="viz-drawer" class="md-drawer" role="dialog" aria-modal="true" aria-labelledby="viz-drawer-title">
            <div class="drawer-head">
              <h3 id="viz-drawer-title">Customize Visualizer</h3>
              <button id="viz-drawer-close" class="icon-btn" aria-label="Close">✕</button>
            </div>
            <div class="drawer-content">
              <div class="customize">
                <div class="viz-style">
                  <label>Visualizer</label>
                  <select id="viz-style">
                    <option value="bars">Bars</option>
                    <option value="wave">Wave</option>
                    <option value="mirror">Mirror Bars</option>
                    <option value="ring">Ring Wave</option>
                    <option value="radial">Radial Bars</option>
                    <option value="particles">Particles</option>
                    <option value="circle">Circle</option>
                  </select>
                </div>
                <div class="viz-template">
                  <label>Style Template</label>
                  <select id="style-template"></select>
                </div>
                <div class="viz-colors">
                  <label>Colors</label>
                  <input type="color" id="viz-color-1" value="#19d3ae"/>
                  <input type="color" id="viz-color-2" value="#1e90ff"/>
                </div>
                <div class="viz-options">
                  <label><input type="checkbox" id="viz-glow" checked/> Glow</label>
                  <label><input type="checkbox" id="viz-trail" checked/> Trail</label>
                  <label><input type="checkbox" id="viz-art" checked/> Center Art</label>
                  <label><input type="checkbox" id="viz-style-presets" /> Style Presets</label>
                  <label><input type="checkbox" id="viz-bpm" /> Show BPM</label>
                  <label><input type="checkbox" id="viz-perf" /> Performance Mode</label>
                </div>

                <div class="viz-mode">
                  <div class="orient">
                    <label>Orientation</label>
                    <select id="viz-orient">
                      <option value="auto" selected>Auto</option>
                      <option value="portrait">Portrait</option>
                      <option value="landscape">Landscape</option>
                    </select>
                  </div>
                  <div class="theme">
                    <label>Theme</label>
                    <select id="theme-select">
                      <option value="dark" selected>Dark</option>
                      <option value="light">Light</option>
                    </select>
                  </div>
                </div>

                <div class="viz-tuning">
                  <label>Rotation <input type="range" id="viz-rot" min="0" max="3" step="0.01" value="0.6"></label>
                  <label>Decay <input type="range" id="viz-decay" min="0.7" max="0.99" step="0.001" value="0.92"></label>
                  <label>Thickness <input type="range" id="viz-thickness" min="0.5" max="3" step="0.01" value="1"></label>
                  <label>Ring Fill <input type="range" id="viz-ring-floor" min="0" max="0.3" step="0.01" value="0.16"></label>
                  <label>Radial Floor <input type="range" id="viz-radial-floor" min="0" max="0.3" step="0.01" value="0.16"></label>
                  <label>Glow Strength <input type="range" id="viz-glow-strength" min="0" max="24" step="1" value="12"></label>
                  <label>Trail Alpha <input type="range" id="viz-trail-alpha" min="0" max="0.3" step="0.01" value="0.08"></label>
                  <label>Spike Scale <input type="range" id="viz-spike-scale" min="0.5" max="2" step="0.01" value="1"></label>
                  <label>Wave Scale <input type="range" id="viz-wave-scale" min="0.5" max="2" step="0.01" value="1"></label>
                  <label>Segments <input type="range" id="viz-segments" min="1" max="8" step="1" value="4"></label>
                  <label>Beat Sensitivity <input type="range" id="viz-beat-sense" min="0.2" max="2" step="0.05" value="1"></label>
                  <label>Beat Boost <input type="range" id="viz-beat-boost" min="0" max="2" step="0.05" value="1"></label>
                  <label>Beat Threshold <input type="range" id="viz-beat-thresh" min="0" max="0.6" step="0.01" value="0.08"></label>
                  <label>Beat Decay <input type="range" id="viz-beat-decay" min="0.7" max="0.99" step="0.001" value="0.90"></label>
                  <label>Beat Source
                    <select id="viz-beat-src">
                      <option value="avg" selected>Average</option>
                      <option value="low">Low</option>
                      <option value="mid">Mid</option>
                      <option value="high">High</option>
                    </select>
                  </label>
                  <label>Beat Hold (ms) <input type="range" id="viz-beat-hold" min="0" max="500" step="10" value="120"></label>
                  <label>Pulse Width <input type="range" id="viz-pulse-w" min="0" max="2" step="0.05" value="1"></label>
                  <label>Emphasis Mode
                    <select id="viz-emphasis-mode">
                      <option value="flat" selected>Flat</option>
                      <option value="weighted">Weighted</option>
                    </select>
                  </label>
                  <label>Low Emphasis <input type="range" id="viz-low-gain" min="0" max="2" step="0.05" value="1"></label>
                  <label>Mid Emphasis <input type="range" id="viz-mid-gain" min="0" max="2" step="0.05" value="1"></label>
                  <label>High Emphasis <input type="range" id="viz-high-gain" min="0" max="2" step="0.05" value="1"></label>
                  <label>Smoothing <input type="range" id="viz-smooth" min="0.5" max="0.95" step="0.01" value="0.75"></label>
                </div>
                <div class="presets">
                  <input type="text" id="preset-name" placeholder="Preset name"/>
                  <button id="save-viz-preset" class="btn">Save Viz Preset</button>
                  <button id="save-eq-preset" class="btn">Save EQ Preset</button>
                  <select id="preset-list"></select>
                  <button id="apply-preset" class="btn">Apply Preset</button>
                  <button id="delete-preset" class="btn">Delete Preset</button>
                </div>
              </div>
            </div>
          </div>
          <div id="viz-scrim" class="md-scrim" aria-hidden="true"></div>

          <!-- Floating Layers Drawer -->
          <div id="layers-drawer" class="md-drawer" role="dialog" aria-modal="true" aria-labelledby="layers-drawer-title">
            <div class="drawer-head">
              <h3 id="layers-drawer-title">Layers</h3>
              <button id="layers-drawer-close" class="icon-btn" aria-label="Close">✕</button>
            </div>
            <div class="drawer-content">
              <div class="customize">

                <div class="panel layers-panel">
                  <div class="panel-head"><h3>Current Layers</h3></div>
                  <ul id="layers-list" class="layers"></ul>
                </div>

                <div class="panel">
                  <div class="panel-head"><h3>Add Layer</h3></div>
                  <div class="viz-style">
                    <label>Layer Style</label>
                    <select id="layer-style">
                      <option value="bars">Bars</option>
                      <option value="wave">Wave</option>
                      <option value="mirror">Mirror Bars</option>
                      <option value="ring">Ring Wave</option>
                      <option value="radial">Radial Bars</option>
                      <option value="particles">Particles</option>
                      <option value="circle">Circle</option>
                    </select>
                  </div>
                  <div class="viz-colors">
                    <label>Colors</label>
                    <input type="color" id="layer-color-1" value="#19d3ae"/>
                    <input type="color" id="layer-color-2" value="#1e90ff"/>
                  </div>
                  <div class="viz-tuning">
                    <label>Segments <input type="range" id="layer-segments" min="1" max="8" step="1" value="2"></label>
                    <label>Blend Mode
                      <select id="layer-blend">
                        <option value="lighter" selected>Lighter</option>
                        <option value="normal">Normal</option>
                        <option value="screen">Screen</option>
                        <option value="multiply">Multiply</option>
                      </select>
                    </label>
                    <label>Opacity <input type="range" id="layer-alpha" min="0" max="1" step="0.05" value="1"></label>
                  </div>
                  <div class="presets">
                    <button id="layer-add2" class="btn primary">Add Layer</button>
                  </div>
                </div>

                <div class="panel">
                  <div class="panel-head"><h3>Edit Selected Layer</h3></div>
                  <div class="viz-style">
                    <label>Style</label>
                    <select id="layer-edit-style">
                      <option value="bars">Bars</option>
                      <option value="wave">Wave</option>
                      <option value="mirror">Mirror Bars</option>
                      <option value="ring">Ring Wave</option>
                      <option value="radial">Radial Bars</option>
                      <option value="particles">Particles</option>
                      <option value="circle">Circle</option>
                    </select>
                  </div>
                  <div class="viz-colors">
                    <label>Colors</label>
                    <input type="color" id="layer-edit-color-1" value="#19d3ae"/>
                    <input type="color" id="layer-edit-color-2" value="#1e90ff"/>
                  </div>
                  <div class="viz-tuning">
                    <label>Rotation <input type="range" id="layer-rot" min="0" max="3" step="0.01" value="0.6"></label>
                    <label>Decay <input type="range" id="layer-decay" min="0.7" max="0.99" step="0.001" value="0.92"></label>
                    <label>Thickness <input type="range" id="layer-thickness" min="0.5" max="3" step="0.01" value="1"></label>
                    <label>Ring Floor <input type="range" id="layer-ring-floor" min="0" max="0.3" step="0.01" value="0.16"></label>
                    <label>Radial Floor <input type="range" id="layer-radial-floor" min="0" max="0.3" step="0.01" value="0.16"></label>
                    <label>Spike Scale <input type="range" id="layer-spike-scale" min="0.5" max="2" step="0.01" value="1"></label>
                    <label>Wave Scale <input type="range" id="layer-wave-scale" min="0.5" max="2" step="0.01" value="1"></label>
                    <label>Segments <input type="range" id="layer-edit-segments" min="1" max="8" step="1" value="2"></label>
                    <label>Blend Mode
                      <select id="layer-edit-blend">
                        <option value="lighter" selected>Lighter</option>
                        <option value="normal">Normal</option>
                        <option value="screen">Screen</option>
                        <option value="multiply">Multiply</option>
                      </select>
                    </label>
                    <label>Opacity <input type="range" id="layer-edit-alpha" min="0" max="1" step="0.05" value="1"></label>
                  </div>
                </div>

              </div>
            </div>
          </div>
          <div id="layers-scrim" class="md-scrim" aria-hidden="true"></div>

          

          <div class="eq-header">
            <span>Equalizer</span>
            <select id="eq-preset">
              <option value="flat">Flat</option>
              <option value="pop">Pop</option>
              <option value="rock">Rock</option>
              <option value="jazz">Jazz</option>
              <option value="bass">Bass Boost</option>
              <option value="treble">Treble Boost</option>
            </select>
            <button id="eq-toggle" class="btn">Show/Hide</button>
          </div>

          <div id="eq-panel" class="eq-panel">
            <div class="bands">
              <div class="band"><label>31</label><input type="range" data-band="0" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>62</label><input type="range" data-band="1" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>125</label><input type="range" data-band="2" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>250</label><input type="range" data-band="3" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>500</label><input type="range" data-band="4" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>1k</label><input type="range" data-band="5" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>2k</label><input type="range" data-band="6" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>4k</label><input type="range" data-band="7" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>8k</label><input type="range" data-band="8" min="-12" max="12" step="0.5" value="0"/></div>
              <div class="band"><label>16k</label><input type="range" data-band="9" min="-12" max="12" step="0.5" value="0"/></div>
            </div>
          </div>

          <!-- Layers panel removed; use floating Layers drawer (☷) -->

          <!-- Project actions -->
          <div class="panel actions-panel">
            <div class="panel-head">
              <h3>Project</h3>
            </div>
            <div class="actions-row">
              <button id="save-project" class="btn primary">Save Project</button>
              <button id="load-project" class="btn secondary">Load Project</button>
              <input type="file" id="load-project-input" accept="application/json" style="display:none"/>
            </div>
            <div class="actions-row">
              <button id="choose-audio" class="btn secondary">Choose audio files</button>
              <button id="snapshot" class="btn secondary">Snapshot</button>
              <button id="record" class="btn primary">Record</button>
            </div>
          </div>

          <!-- Live Console -->
          <div class="panel console-panel">
            <div class="panel-head">
              <h3>Live Console</h3>
              <div class="panel-actions">
                <button id="debug-toggle" class="btn secondary">Enable Debug</button>
                <button id="console-clear" class="btn secondary">Clear</button>
              </div>
            </div>
            <div id="live-console"></div>
          </div>

          <!-- Status -->
          <div class="panel status-panel">
            <div class="panel-head">
              <h3>Status</h3>
            </div>
            <pre id="status-info" class="status-pre">Initializing…</pre>
          </div>

        </div>
      </section>

      <!-- Playlists Sidebar -->
      <aside class="sidebar playlists">
        <ul id="playlists" class="list"></ul>
        <div id="playlist-details" class="playlist-details">
          <h3 id="playlist-title">Playlist</h3>
          <ul id="playlist-tracks" class="list tracks"></ul>
        </div>
      </aside>
    </div>
  </main>

  

  

  <!-- Upload progress overlay -->
  <div id="upload-overlay" class="md-overlay" aria-hidden="true">
    <div class="box">
      <div class="spinner"></div>
      <div class="text" id="upload-status">Uploading…</div>
    </div>
  </div>

  

  <!-- Playlist Select Drawer (for actions requiring a target) -->
  <div id="pl-select-drawer" class="md-drawer" role="dialog" aria-modal="true" aria-labelledby="pl-select-drawer-title">
    <div class="drawer-head">
      <h3 id="pl-select-drawer-title">Select Playlist</h3>
      <button id="pl-select-close" class="icon-btn" aria-label="Close">✕</button>
    </div>
    <div class="drawer-content">
      <ul id="pl-select-list" class="list"></ul>
    </div>
  </div>
  <div id="pl-select-scrim" class="md-scrim" aria-hidden="tr"></</div>

  <!-- Add to Playlist Drawer -->
 < div id="pl-add-drawer" class="md-drawer" role="dialog" aria-modal="true" aria-labelledby="pl-add-drawer-title">
   < div class="drawer-head">
     < h3 id="pl-add-drawer-title">Add to Playli</sth3>
     < button id="pl-add-close" class="icon-btn" aria-label="Close"</>✕button>
  </  div>
   < div class="drawer-content">
     < div class="customize">
       < div class="viz-style">
         < label>Target Playli</stlabel>
         < select id="pl-add-targ"></etselect>
      </  div>
       < div class="viz-style">
         < label>Filt</erlabel>
         < input type="text" id="pl-add-filter" placeholder="Type to filter…"/>
      </  div>
       < div class="presets">
         < button id="pl-add-btn" class="btn primary">Add select</edbutton>
      </  div>
       < div class="list" id="pl-add-lib-list" style="max-height:50vh; overflow:au;"></todiv>
    </  div>
  </  div> </
 div>
 < div id="pl-add-s>

  <footer>
    <p>&copy; 2025 Avee-like Player (PHP)</p>
  </footer>

  

  <script src="assets/js/utils.js?v=20251020-17"></script>
  <script src="assets/js/equalizer.js?v=20251020-17"></script>
  <script src="assets/js/visualizer.js?v=20251020-"></</script>
 <<script src="assets/js/playlists.js?v=20251020-17"></script>
  <script src="assets/js/settings.js?v=20251020-17"></script>
  <script src="assets/js/cloud.js?v=20251020-17"></script>
  <script src="assets/js/logger.js?v=20251020-17"></script>
  <script src="assets/js/toast.js?v=20251020-17"></script>
  <script src="assets/script.js?v=20251020-17"></script>
  <script>
    // Drawer open/close handling (customize + layers only)
    (function() {
      function qs(id){ return document.getElementById(id); }
      const fab = qs('fab-customize');
      const drawer = qs('viz-drawer');
      const scrim = qs('viz-scrim');
      const closeBtn = qs('viz-drawer-close');

      function openDrawer() {
        if (!drawer) return;
        drawer.classList.add('open');
        if (scrim) scrim.classList.add('show');
      }
      function closeDrawer() {
        if (!drawer) return;
        drawer.classList.remove('open');
        if (scrim) scrim.classList.remove('show');
      }

      if (fab) fab.addEventListener('click', openDrawer);
      if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
      if (scrim) scrim.addEventListener('click', closeDrawer);
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeDrawer();
        }
      });

      // Layers drawer open/close
      const fabLayers = qs('fab-layers');
      const layersDrawer = qs('layers-drawer');
      const layersScrim = qs('layers-scrim');
      const layersClose = qs('layers-drawer-close');
      function openLayers() {
        if (layersDrawer) layersDrawer.classList.add('open');
        if (layersScrim) layersScrim.classList.add('show');
        try { if (window.App && App.renderLayersUI) App.renderLayersUI(); } catch (_) {}
        try { if (window.App && App.syncLayerEditForm) App.syncLayerEditForm(); } catch (_) {}
      }
      function closeLayers() {
        if (layersDrawer) layersDrawer.classList.remove('open');
        if (layersScrim) layersScrim.classList.remove('show');
      }
      if (fabLayers) fabLayers.addEventListener('click', openLayers);
      if (layersClose) layersClose.addEventListener('click', closeLayers);
      if (layersScrim) layersScrim.addEventListener('click', closeLayers);

      // Add Layer via layers drawer with style choice and perf guard
      const layerAdd2 = qs('layer-add2');
      if (layerAdd2) layerAdd2.addEventListener('click', () => {
        try {
          const style = (qs('layer-style')?.value) || 'circle';
          const c1 = (qs('layer-color-1')?.value) || '#19d3ae';
          const c2 = (qs('layer-color-2')?.value) || '#1e90ff';
          const seg = Number((qs('layer-segments')?.value) || 2);
          const blend = (qs('layer-blend')?.value) || 'lighter';
          const alpha = Number((qs('layer-alpha')?.value) || 1);
          const idx = App.state.viz.addLayer(style, {
            color1: c1, color2: c2,
            rotation: Number(document.getElementById('viz-rot').value || 0.6),
            thickness: Number(document.getElementById('viz-thickness').value || 1),
            ringFloor: Number(document.getElementById('viz-ring-floor').value || 0.16),
            radialFloor: Number(document.getElementById('viz-radial-floor').value || 0.16),
            spikeScale: Number(document.getElementById('viz-spike-scale').value || 1),
            waveScale: Number(document.getElementById('viz-wave-scale').value || 1),
            segments: Math.max(1, Math.min(8, seg)),
            blend,
            alpha
          });
          App.state.viz.selectLayer(idx);
          App.renderLayersUI();
          // Performance guard: if more than 1 layer, enforce performance mode and soften trail
          const count = App.state.viz.getLayers().length;
          if (count > 1 && App.state.viz.setPerformanceMode) {
            App.state.viz.setPerformanceMode(true);
            const perfToggle = document.getElementById('viz-perf'); if (perfToggle) perfToggle.checked = true;
            if (App.state.viz.setTrailAlpha) App.state.viz.setTrailAlpha(0.05);
            if (App.state.viz.setGlowStrength) App.state.viz.setGlowStrength(Math.min(12, Number(document.getElementById('viz-glow-strength').value || 12)));
          }
          try { Toast && Toast.show('Layer added', 'success', 1500); } catch (_) {}
          closeLayers();
        } catch (err) {
          console.error('Add layer failed', err);
          try { Toast && Toast.show('Add layer failed: ' + err.message, 'error'); } catch (_) {}
        }
      });
    })();
  </script>

  <script src="assets/js/app.js?v=20251020-"></</scr_code</body>
</html>